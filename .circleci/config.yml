version: 2.1

executors:
  minimal-executor:
    docker:
      - image: cimg/base:stable

  python-service-executor:
    docker:
      - image: cimg/python:3.11
      - image: localstack/localstack:latest
        name: localstack
        environment:
          SERVICES: s3,secretsmanager
          EDGE_PORT: 4566
      - image: postgres:13
        name: postgres
        environment:version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@1.3.0  # Official CircleCI path-filtering orb

workflows:
  root-workflow:
    jobs:

      - path-filtering/filter:
          name: root-pipeline-filter
          base-revision: main
          config-path: .circleci/migrations-config.yml
          mapping: |
            db_migrations/japan/.* build_japan true
            db_migrations/latam/.* build_latam true


